<!DOCTYPE html>

<html lang="en">

<head>

	<title>Universal Glacier Profiler - Icemen</title>
	
	<!--Metadata and scripts-->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	
		
	<!-- Planning to move this CSS to a separate sheet-->
	<style>
	table, th, td {
	border: 1px solid black;
	}
	td{
		height:40px;
	
	}
	
	<!-- style for map -->
    /* styles */

    html, body {
      margin: 0;
      padding: 0;
    }

    #map {
      width: 45vw;
      height: 100vh;
    }
	</style>
	

</head>

<body>

	<!--Creates the navigation bar on the top of the page-->
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">Universal Glacier Profiler</a>
				
			</div>
			<div class="col-lg-6"></div>
			<div class="col-md-2"></div>
			<div class="navbar-header">
				<a class="navbar-brand" href="#">Icemen Develompment Group</a>
				
		</div>
		
	</nav>
	
	<!--Creates the page body-->
	<main role="main" class="container-fluid">
		
		<!-- Creates the map image container-->
		<div class="row">
			<div class="col-12 col-md-6 left-sidebar">
				<div class="text-center">
					
					<!-- Drop down for selecting different types of maps depending on the value. -->
					<select id="mapType">
						<option value="0">Velocity</option>
						<option value="1">Bed</option>
						<option value="2">Surface</option>
						<option value="3">SMB</option>
						<option value="4">Thickness</option>
						<option value="5">T2M</option>
					</select>
					
					<script>
					//This will be the function that takes in the value from the drop down menu
					//and then it will graph the tiles out of the right folder. 
					var menu = document.getElementById("mapType");
					menu.addEventListener("change", changeMap);

					function changeMap(event) {
					  if (menu.value == '0') {
						var TILE_URL = '../velocityTiles/{z}_{x}_{y}.png';
					  } else if (menu.value == '1') {
						var TILE_URL = '../bedTiles/{z}_{x}_{y}.png';
					  } else if (menu.value == '2') {
						var TILE_URL = '../surfaceTiles/{z}_{x}_{y}.png';
					  }
					  else if (menu.value == '3') {
						var TILE_URL = '../SMBTiles/{z}_{x}_{y}.png';
					  }
					  else if (menu.value == '4') {
						var TILE_URL = '../ThicknessTiles/{z}_{x}_{y}.png';
					  }
					  else if (menu.value == '5') {
						var TILE_URL = '../T2MTiles/{z}_{x}_{y}.png';
					  }
					}	
					</script>
					
					
					<!-- Map container -->
					<div id="map"></div>
					
					<script>
					var TILE_URL = '../testTiles/{z}_{x}_{y}.png';

					var map;
					var mapEl;
					var layer;
					var layerID = 'my-custom-layer';



					window.initMap = function() {
					  // Select the element with id="map".
					  mapEl = document.querySelector('#map');
					  
					  // Create a new map.
					  map = new google.maps.Map(mapEl, {
						center: new google.maps.LatLng(71.7069, -42.6043),
						zoom: 4,
                          disableDoubleClickZoom: true,
					  });

					  //This listener catches the mouse click coordinates and sends it via AJAX to server
                        //Returns a JSON object
                        map.addListener('click', function (event) {
                            var lineLat;
                            var lineLon;
                            var flowlineInput;
                            var flowlineOutput = {};

                            lineLat = event.latLng.lat();
                            console.log(lineLat);
                            lineLon = event.latLng.lng();
                            console.log(lineLon);
                            flowlineInput = {'lon': lineLon, 'lat': lineLat};

                            console.log("Clicked...");
                            $.ajax({
                                type: 'POST',
                                url: '/ajax/get_flowline/', //this url is specified on server
                                data: JSON.stringify(flowlineInput),
                                contentType: 'application/json',
                                success: function (d) {
                                    console.log("Success!");
                                    flowlineOutput = d;
                                    console.log(flowlineOutput);

                                },
                                failure: function (d) {
                                    console.log("AJAX Failed");
                                    console.log(d.status);
                                }

                            });


                      });
					  
					  // Create a tile layer, configured to fetch tiles from TILE_URL.
					  layer = new google.maps.ImageMapType({
						name: layerID,
						getTileUrl: function(coord, zoom) {
						  console.log(coord);
						  var url = TILE_URL
							.replace('{x}', coord.x)
							.replace('{y}', coord.y)
							.replace('{z}', zoom);
							console.log(url);
						  return url;
						},
						tileSize: new google.maps.Size(256, 256),
						minZoom: 2,
						maxZoom: 7
					  });
					  
					  // Apply the new tile layer to the map.
					  map.mapTypes.set(layerID, layer);
					  map.setMapTypeId(layerID);
					};
					</script>
					
					<!-- NOTE: The 'key' parameter should be replaced with your Google Maps API Key. -->
					<script async defer
					src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZbuGSEBqEPNHYvx1MzAIeX3MU6jOHjMw&callback=initMap">
					</script>
					
				</div>
				
			</div>
			
			<!--Creates the right side pane-->
			<div class="col-12 col-md-6 right-sidebar">
				<div class="row">
					<h4 class="text-left">Enter a coordinate in lat/long to view data at point:</h4>
					
					<div class="col-xs-3">
						<label for="latinput">Latitude</label>
						
						<input type="text" class="form-control" id="latinput">
						
					</div>
					<div class="col-xs-1">
						<div class="row">
							<div class="panel-body"></div>
						</div>
						<div class="row">
							<h5>N,</h5>
						</div>
					</div>
					<div class="col-xs-3">
						<label for="latinput">Longitude</label>
						
						<input type="text" class="form-control" id="longinput">
						
					</div>
					<div class="col-xs-1">
						<div class="row">
							<div class="panel-body"></div>
						</div>
						<div class="row">
							<h5>S</h5>
						</div>
					</div>
					<div class="col-xs-3">
						<button type="button" class="btn btn-primary" id="gobutton" name="go" value="Go">Fetch data</button>
						
					</div>
					
				</div>
				<div class="row">
					<div class="panel-body"></div>
					
				</div>

				<div class="row">

					<!--Creates the table-->
					<table style="width:100%" id="consoletable">
						<tr>
							<th>Point</th>
							<th>Velocity</th>
							<th>Bed</th>
							<th>Surface</th>
							<th>SMB</th>
							<th>Thickness</th>
							<th>T2M</th>
							
						</tr>
						
					</table>
				
			</div>
			
		</div>
		
	
    <script src="bootstrap-slider.min.js"></script>
	<script src="script.js"></script>
	
</body>

</html>